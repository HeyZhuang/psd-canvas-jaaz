# Jaaz æœå‹™ç«¯å£é…ç½®èªªæ˜

## ğŸ“‹ æ­£ç¢ºçš„ç«¯å£é…ç½®

### å‰ç«¯æœå‹™
- **ç«¯å£**: `3100`
- **é…ç½®æ–‡ä»¶**: `react/vite.config.ts`
- **é…ç½®é …**: `server.port = 3100`
- **è¨ªå•åœ°å€**: http://localhost:3100
- **ä¸»è¦é é¢**: http://localhost:3100/canvas/default

### å¾Œç«¯æœå‹™  
- **ç«¯å£**: `58000`
- **é…ç½®æ–‡ä»¶**: `server/main.py`
- **é…ç½®é …**: `--port 58000` (é»˜èªå€¼)
- **è¨ªå•åœ°å€**: http://localhost:58000
- **APIæ–‡æª”**: http://localhost:58000/docs

### APIä»£ç†é…ç½®
- **é…ç½®æ–‡ä»¶**: `react/vite.config.ts`
- **ä»£ç†è¦å‰‡**: `/api` â†’ `http://127.0.0.1:58000`
- **WebSocket**: `/ws` â†’ `ws://127.0.0.1:58000`

## ğŸ” å¦‚ä½•æª¢æŸ¥ç•¶å‰é…ç½®

### æ–¹æ³• 1ï¼šä½¿ç”¨è¨ºæ–·è…³æœ¬ï¼ˆæ¨è–¦ï¼‰
```bash
cd /home/ubuntu/jaaz
./test_æ™ºèƒ½ç¸®æ”¾é€£æ¥.sh
```

### æ–¹æ³• 2ï¼šæ‰‹å‹•æª¢æŸ¥
```bash
# æª¢æŸ¥å‰ç«¯ç«¯å£
lsof -i :3100 | grep LISTEN

# æª¢æŸ¥å¾Œç«¯ç«¯å£  
lsof -i :58000 | grep LISTEN

# æª¢æŸ¥é€²ç¨‹è©³æƒ…
ps aux | grep "vite"
ps aux | grep "python.*main.py"
```

### æ–¹æ³• 3ï¼šæ¸¬è©¦é€£æ¥
```bash
# æ¸¬è©¦å‰ç«¯
curl http://localhost:3100/

# æ¸¬è©¦å¾Œç«¯
curl http://localhost:58000/api/config

# æ¸¬è©¦å‰ç«¯APIä»£ç†
curl http://localhost:3100/api/config
```

## âš™ï¸ é…ç½®æ–‡ä»¶è©³æƒ…

### react/vite.config.ts
```typescript
const PORT = 58000  // å¾Œç«¯ç«¯å£

export default defineConfig(({ mode }) => {
  const config: UserConfig = {
    server: {
      port: 3100,  // å‰ç«¯ç«¯å£
      proxy: {},
    },
  }

  if (mode === 'development') {
    config.server.proxy = {
      '/api': {
        target: `http://127.0.0.1:${PORT}`,  // ä»£ç†åˆ°å¾Œç«¯
        changeOrigin: true,
      },
      '/ws': {
        target: `ws://127.0.0.1:${PORT}`,
        ws: true,
      },
    }
  }

  return config
})
```

### server/main.py
```python
if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('--port', type=int, default=58000,
                        help='Port to run the server on')
    args = parser.parse_args()

    import uvicorn
    uvicorn.run(
        app,
        host='127.0.0.1',
        port=args.port,  # é»˜èª 58000
    )
```

### server/common.py
```python
DEFAULT_PORT = int(os.environ.get('DEFAULT_PORT', 58000))
```

## ğŸš€ å•Ÿå‹•æœå‹™

### å‰ç«¯å•Ÿå‹•
```bash
cd /home/ubuntu/jaaz/react
npm run dev
# æˆ–ä½¿ç”¨è…³æœ¬
cd /home/ubuntu/jaaz
./restart_frontend.sh
```

### å¾Œç«¯å•Ÿå‹•
```bash
cd /home/ubuntu/jaaz/server
python main.py
# æˆ–ä½¿ç”¨è…³æœ¬  
cd /home/ubuntu/jaaz
./restart_backend.sh

# æˆ–æŒ‡å®šç«¯å£
cd /home/ubuntu/jaaz/server
python main.py --port 58000
```

## ğŸ”§ ä¿®æ”¹ç«¯å£ï¼ˆå¦‚æœéœ€è¦ï¼‰

### ä¿®æ”¹å‰ç«¯ç«¯å£
ç·¨è¼¯ `react/vite.config.ts`:
```typescript
server: {
  port: æ‚¨çš„æ–°ç«¯å£,  // ä¾‹å¦‚ï¼š3000
  proxy: {},
}
```

### ä¿®æ”¹å¾Œç«¯ç«¯å£
æ–¹æ³•1 - ç’°å¢ƒè®Šé‡:
```bash
export DEFAULT_PORT=æ‚¨çš„æ–°ç«¯å£
python main.py
```

æ–¹æ³•2 - å‘½ä»¤è¡Œåƒæ•¸:
```bash
python main.py --port æ‚¨çš„æ–°ç«¯å£
```

æ–¹æ³•3 - ä¿®æ”¹ä»£ç¢¼:
ç·¨è¼¯ `server/main.py`:
```python
parser.add_argument('--port', type=int, default=æ‚¨çš„æ–°ç«¯å£)
```

### âš ï¸ é‡è¦æé†’
å¦‚æœä¿®æ”¹äº†å¾Œç«¯ç«¯å£ï¼Œå¿…é ˆåŒæ­¥ä¿®æ”¹å‰ç«¯ä»£ç†é…ç½®ï¼š

ç·¨è¼¯ `react/vite.config.ts`:
```typescript
const PORT = æ‚¨çš„æ–°å¾Œç«¯ç«¯å£  // ä¿®æ”¹é€™è£¡
```

## ğŸ› å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼ check_services.sh é¡¯ç¤ºéŒ¯èª¤çš„ç«¯å£ï¼Ÿ
A: è©²è…³æœ¬å¯èƒ½å·²éæ™‚ã€‚è«‹ä½¿ç”¨ `test_æ™ºèƒ½ç¸®æ”¾é€£æ¥.sh` é€²è¡Œè¨ºæ–·ã€‚

### Q: å¦‚ä½•ç¢ºèªä»£ç†æ˜¯å¦å·¥ä½œï¼Ÿ
A: é‹è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
curl http://localhost:3100/api/config
```
å¦‚æœè¿”å› JSON æ•¸æ“šï¼ˆè€Œä¸æ˜¯ 404ï¼‰ï¼Œä»£ç†å°±æ˜¯å·¥ä½œçš„ã€‚

### Q: å‰ç«¯ç„¡æ³•é€£æ¥åˆ°å¾Œç«¯æ€éº¼è¾¦ï¼Ÿ
A: æŒ‰é †åºæª¢æŸ¥ï¼š
1. å¾Œç«¯æ˜¯å¦é‹è¡Œï¼š`lsof -i :58000`
2. å‰ç«¯æ˜¯å¦é‹è¡Œï¼š`lsof -i :3100`
3. ä»£ç†é…ç½®æ˜¯å¦æ­£ç¢ºï¼šæŸ¥çœ‹ `react/vite.config.ts`
4. é‡å•Ÿå…©å€‹æœå‹™

### Q: APIè«‹æ±‚è¿”å› 502/503 éŒ¯èª¤ï¼Ÿ
A: é€™è¡¨ç¤ºå¾Œç«¯æœªé‹è¡Œæˆ–ç„¡æ³•è¨ªå•ã€‚è«‹ï¼š
1. æª¢æŸ¥å¾Œç«¯é€²ç¨‹ï¼š`ps aux | grep "python.*main.py"`
2. é‡å•Ÿå¾Œç«¯ï¼š`./restart_backend.sh`
3. æŸ¥çœ‹å¾Œç«¯æ—¥èªŒï¼š`tail -50 /home/ubuntu/jaaz/server/backend.log`

## ğŸ“Š ç«¯å£ä½¿ç”¨ç¸½è¦½

| æœå‹™ | ç«¯å£ | å”è­° | ç”¨é€” |
|------|------|------|------|
| å‰ç«¯ Vite | 3100 | HTTP | Webç•Œé¢æœå‹™ |
| å¾Œç«¯ FastAPI | 58000 | HTTP/WS | APIæœå‹™å’ŒWebSocket |
| å‰ç«¯ä»£ç† | 3100 â†’ 58000 | HTTP | APIè«‹æ±‚è½‰ç™¼ |

## âœ… é©—è­‰æ¸…å–®

é…ç½®æ­£ç¢ºæ™‚ï¼Œæ‡‰è©²èƒ½çœ‹åˆ°ï¼š

- [ ] `lsof -i :3100` é¡¯ç¤º node é€²ç¨‹
- [ ] `lsof -i :58000` é¡¯ç¤º python é€²ç¨‹  
- [ ] `curl http://localhost:3100/` è¿”å› HTML
- [ ] `curl http://localhost:58000/api/config` è¿”å› JSON
- [ ] `curl http://localhost:3100/api/config` è¿”å›ç›¸åŒçš„ JSON
- [ ] ç€è¦½å™¨è¨ªå• http://localhost:3100 èƒ½çœ‹åˆ°ç•Œé¢

---

**æœ€å¾Œæ›´æ–°**: 2025-10-29
**è¨ºæ–·å·¥å…·**: test_æ™ºèƒ½ç¸®æ”¾é€£æ¥.sh




