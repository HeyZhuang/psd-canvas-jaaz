# PSD 完整预览功能使用指南

## 🎉 功能简介

**PSD 完整预览功能**允许您在智能缩放整个 PSD 文件之前，预览 AI 生成的缩放效果。您可以：
- 👀 预览所有图层的新位置和尺寸
- ✋ 拖拽调整任意图层
- 🎯 精确设置图层位置和属性
- 👁️ 切换图层可见性
- ✅ 确认满意后执行实际缩放

---

## 🆕 新增功能

### ✅ 已实现

**1. PSD 文件预览** - 刚刚实现！
- 预览整个 PSD 文件的所有图层
- 完整功能，不再显示"即将推出"
- 与选中图层预览功能类似的交互体验

**2. 选中图层预览** - 之前已实现
- 预览选中的特定图层
- 完全可用

### ⏳ 待实现

**画布预览** - 规划中
- 预览整个画布的所有图层
- 预计 1 个月内推出

---

## 🚀 使用步骤

### 1. 上传 PSD 文件

```
1. 打开画布页面
2. 点击工具栏的 PSD 上传按钮
3. 选择您的 PSD 文件
4. 等待上传和解析完成
```

### 2. 打开智能缩放对话框

```
方式1：从菜单打开
- 点击顶部菜单
- 选择"PSD 智能缩放"

方式2：从图层侧边栏打开
- 打开 PSD 图层侧边栏
- 点击底部"智能缩放"按钮
```

### 3. 配置缩放参数

```
1. 选择缩放模式: "缩放单个PSD文件"
2. 设置目标尺寸:
   - 目标宽度（如: 800）
   - 目标高度（如: 600）
3. 可选：输入 Gemini API 密钥
   （如果不输入，将使用环境变量中的密钥）
```

### 4. 点击预览按钮 ⭐

```
1. 找到"预览效果"按钮（不再有"即将推出"标记）
2. 点击该按钮
3. 等待 AI 生成预览（1-2 分钟）
```

### 5. 查看和调整预览

**预览界面布局：**
```
┌─────────────────────────────────────┬──────────────┐
│                                     │  图层列表     │
│          预览画布                    │              │
│   （显示所有图层的新位置）             │  [图层1]     │
│                                     │  [图层2]     │
│                                     │  [图层3]     │
│                                     │  ...         │
│                                     │              │
│                                     │  精确调整面板  │
│                                     │  ├ X位置     │
│                                     │  ├ Y位置     │
│                                     │  ├ 宽度      │
│                                     │  ├ 高度      │
│                                     │  └ 不透明度   │
└─────────────────────────────────────┴──────────────┘
```

**可用操作：**
- 🖱️ **拖拽图层** - 在预览画布上直接拖拽调整位置
- 👆 **点击选择** - 点击图层查看详细信息
- 📝 **数值输入** - 在右侧面板精确设置
- 👁️ **切换可见性** - 点击眼睛图标显示/隐藏图层
- 🔄 **重置调整** - 点击"重置所有"按钮

### 6. 确认并应用

```
满意预览效果后:
1. 点击"确认并应用"按钮
2. 自动执行实际缩放
3. 缩放后的图层添加到画布
```

---

## 🎯 功能特点

### 核心功能

**1. 完整预览**
- ✅ 预览所有图层（不仅是选中的）
- ✅ 显示 AI 预测的新位置和尺寸
- ✅ 实时可视化效果

**2. 交互调整**
- ✅ 拖拽移动图层
- ✅ 数值输入精确调整
- ✅ 滑块控制不透明度
- ✅ 支持调整 X/Y 位置、宽度、高度

**3. 图层管理**
- ✅ 显示/隐藏单个图层
- ✅ 显示/隐藏所有隐藏图层（切换开关）
- ✅ 图层缩略图展示
- ✅ 图层类型标识（文字/图片/组）

**4. 状态追踪**
- ✅ 显示图层总数
- ✅ 显示可见图层数
- ✅ 标记已调整的图层
- ✅ 重置所有调整功能

### 用户体验

**1. 智能辅助**
- 🤖 AI 自动计算最佳位置
- 🎯 保持图层相对位置
- 📏 等比例缩放
- 💡 智能避免重叠

**2. 视觉反馈**
- 🎨 网格背景辅助定位
- 🔵 选中图层高亮显示
- 🟡 调整过的图层标记
- 👁️ 可见性图标实时更新

**3. 性能优化**
- ⚡ 图层缩略图缓存
- 🎯 按需加载图片
- 🔄 流畅的拖拽体验
- ⏱️ 实时预览更新

---

## 📊 与选中图层预览的对比

| 特性 | PSD 完整预览 | 选中图层预览 |
|------|-------------|-------------|
| **适用场景** | 缩放整个 PSD | 缩放部分图层 |
| **预览图层** | 所有图层 | 仅选中图层 |
| **处理速度** | 较慢（图层多） | 较快 |
| **调整灵活性** | 可调整所有图层 | 仅调整选中图层 |
| **资源消耗** | 较高 | 较低 |
| **推荐使用** | 完整项目缩放 | 局部优化 |

---

## 💡 使用建议

### 何时使用 PSD 完整预览

**推荐场景：**
- ✅ 需要缩放整个 PSD 文件
- ✅ 想保持所有图层的相对关系
- ✅ 需要全局查看效果
- ✅ 有时间等待 AI 处理

**不推荐场景：**
- ❌ 只需要调整几个图层
- ❌ PSD 文件特别大（>50 层）
- ❌ 时间紧急
- ❌ 网络较慢

### 何时使用选中图层预览

**推荐场景：**
- ✅ 只需要调整特定图层
- ✅ 想要快速预览
- ✅ PSD 文件很大
- ✅ 分步骤处理项目

---

## 🔧 高级功能

### 1. 图层可见性管理

**显示/隐藏单个图层：**
```
1. 在图层列表中找到目标图层
2. 点击图层左侧的眼睛图标
3. 图层在预览中立即显示/隐藏
```

**显示所有隐藏图层：**
```
1. 找到图层列表顶部的"显示隐藏"开关
2. 开启开关
3. 所有隐藏图层显示在列表中（半透明）
```

### 2. 精确调整

**使用精确调整面板：**
```
1. 点击图层选中它
2. 右侧显示精确调整面板
3. 输入精确的数值：
   - X/Y 位置（像素）
   - 宽度/高度（像素）
   - 不透明度（0-100%）
```

**快捷调整技巧：**
- 🎯 输入框支持键盘上下箭头微调
- 🎚️ 不透明度滑块快速调节
- 📐 保持宽高比：调整一个值后自动计算另一个

### 3. 批量操作

**重置所有调整：**
```
1. 点击底部"重置所有"按钮
2. 所有手动调整将被清除
3. 恢复到 AI 预测的原始位置
```

**重新生成预览：**
```
1. 点击"重新预览"按钮
2. 重新调用 Gemini API
3. 生成新的预览（可能得到不同结果）
```

---

## 🎬 完整使用示例

### 示例1：基础预览流程

```
场景：将 1920x1080 的 PSD 缩放到 800x600

步骤：
1. 上传 PSD 文件 "poster_design.psd"
   ✅ 包含 15 个图层

2. 打开智能缩放对话框
   ✅ 选择"缩放单个PSD文件"

3. 配置参数
   ✅ 目标宽度: 800
   ✅ 目标高度: 600
   ✅ 输入 API 密钥

4. 点击"预览效果"
   ⏱️ 等待约 90 秒

5. 查看预览
   👀 所有 15 个图层已重新布局
   🎯 标题图层居中
   📐 背景图层填满画布

6. 微调位置
   🖱️ 拖拽标题图层向下 20px
   📝 调整 logo 不透明度到 80%

7. 确认应用
   ✅ 点击"确认并应用"
   ✅ 缩放完成，图层已添加到画布
```

### 示例2：高级调整流程

```
场景：复杂设计稿缩放，需要精确控制

步骤：
1. 上传大型 PSD "ui_design.psd"
   📊 30 个图层，原尺寸 2560x1440

2. 预览缩放到 1280x720
   ⏱️ 等待约 120 秒

3. 检查预览
   ⚠️ 发现部分图层位置不理想

4. 逐层调整
   - 图层 "Header"
     ├ X: 100 → 120（右移 20px）
     ├ Y: 50 → 60（下移 10px）
     └ 宽度: 1080 → 1040（缩小）
   
   - 图层 "Button Group"
     ├ Y: 600 → 620
     └ 不透明度: 100% → 90%
   
   - 图层 "Background Pattern"
     └ 可见性: 显示 → 隐藏

5. 对比检查
   🔄 点击"重置所有"查看 AI 原始方案
   🔄 撤销重置，保留手动调整

6. 最终确认
   ✅ 共调整 3 个图层
   ✅ 其他 27 个图层使用 AI 方案
   ✅ 点击"确认并应用"
```

---

## ⚡ 性能优化建议

### 1. 大型 PSD 处理

**如果 PSD 文件很大（>30 层）：**

**方案 A：分组预览**
```
1. 先隐藏部分图层
2. 只预览核心图层
3. 确认后再预览其他图层
```

**方案 B：使用选中图层预览**
```
1. 在图层侧边栏选中重要图层
2. 使用"选中图层预览"功能
3. 分批处理，逐步完成
```

### 2. API 调用优化

**减少 API 调用次数：**
```
1. 一次性配置好所有参数
2. 避免频繁点击"重新预览"
3. 手动调整后直接应用，不要重新生成
```

### 3. 网络优化

**在网络较慢时：**
```
1. 使用有线网络代替 WiFi
2. 关闭其他占用带宽的应用
3. 考虑使用本地 Gemini API
```

---

## 🐛 常见问题

### Q1: 预览加载很慢怎么办？

**A:** 
- ⏱️ 正常情况下需要 1-2 分钟
- 🔄 如果超过 3 分钟，刷新页面重试
- 📡 检查网络连接
- 🔑 确认 API 密钥有效

### Q2: 预览效果不满意怎么办？

**A:**
- 🔄 点击"重新预览"重新生成
- ✋ 手动调整图层位置
- 📝 修改目标尺寸后重新预览
- 🎯 使用选中图层预览分步处理

### Q3: 预览后不想应用怎么办？

**A:**
- ❌ 直接点击"取消"按钮
- 🔒 不会影响原始 PSD 文件
- 🔄 可以修改参数后重新预览

### Q4: 调整后找不到原来的效果？

**A:**
- 🔄 点击"重置所有"恢复 AI 方案
- 🔄 或者点击"重新预览"重新生成

### Q5: 某些图层预览不显示？

**A:**
- 👁️ 检查图层是否被隐藏
- 🔛 开启"显示隐藏"开关
- 📊 查看图层缩略图是否加载

### Q6: 预览和实际效果不一致？

**A:**
- 💾 确保点击了"确认并应用"
- 🎯 检查是否有图层被手动调整
- 🔄 重新预览后再应用

---

## 📝 快捷键和技巧

### 预览画布操作

| 操作 | 方法 |
|------|------|
| **移动图层** | 拖拽图层 |
| **选择图层** | 点击图层 |
| **放大画布** | 点击 🔍+ 按钮 |
| **缩小画布** | 点击 🔍- 按钮 |
| **适应屏幕** | 点击 □ 按钮 |

### 图层列表操作

| 操作 | 方法 |
|------|------|
| **显示/隐藏** | 点击 👁️ 图标 |
| **选中图层** | 点击图层项 |
| **显示隐藏层** | 开启顶部开关 |
| **滚动列表** | 鼠标滚轮 |

### 调整面板操作

| 操作 | 方法 |
|------|------|
| **精确输入** | 输入框输入数值 |
| **微调数值** | 键盘 ↑↓ 键 |
| **调整不透明度** | 拖动滑块 |
| **应用调整** | 自动保存 |

---

## 🎯 最佳实践

### 1. 预览前准备

**✅ 推荐做法：**
- 检查 PSD 文件图层命名清晰
- 删除不需要的隐藏图层
- 确保网络连接稳定
- 准备好 Gemini API 密钥

**❌ 避免做法：**
- 不要在预览时频繁切换页面
- 不要在加载时关闭对话框
- 不要使用过时的 PSD 文件格式

### 2. 调整技巧

**✅ 推荐做法：**
- 先查看整体效果再微调
- 从重要图层开始调整
- 使用数值输入精确控制
- 保存多个版本对比

**❌ 避免做法：**
- 不要调整所有图层（保留 AI 方案）
- 不要频繁点击重新预览
- 不要调整后不应用就关闭

### 3. 效率提升

**工作流程：**
```
1. 快速预览 → 查看整体效果
2. 识别问题 → 标记需要调整的图层
3. 精确调整 → 只修改问题图层
4. 确认应用 → 直接使用
```

---

## 🔗 相关功能

### 已实现功能

- ✅ **选中图层预览** - 预览部分图层
- ✅ **PSD 完整预览** - 预览所有图层（本功能）
- ✅ **导出功能** - 多格式导出
- ✅ **智能缩放** - AI 驱动的缩放

### 规划中功能

- ⏳ **画布预览** - 预览整个画布
- ⏳ **预览历史** - 查看历史预览记录
- ⏳ **预览对比** - 对比不同方案
- ⏳ **预览导出** - 导出预览结果

---

## 📞 技术支持

### 遇到问题？

1. **查看控制台日志** (F12)
   - 检查 API 错误
   - 查看网络请求

2. **检查服务器状态**
   ```bash
   # 后端日志
   tail -f /tmp/jaaz-server.log
   
   # 前端日志
   tail -f /tmp/jaaz-frontend.log
   ```

3. **重启服务**
   ```bash
   # 重启后端
   pkill -f "python.*main.py"
   cd /home/ubuntu/jaaz/server && python main.py
   
   # 重启前端
   pkill -f "vite"
   cd /home/ubuntu/jaaz/react && npm run dev
   ```

---

## 🎉 总结

**PSD 完整预览功能**为您提供了：

- ✅ **完整可视化** - 预览所有图层的 AI 缩放效果
- ✅ **灵活调整** - 手动微调任意图层
- ✅ **实时反馈** - 即时看到调整结果
- ✅ **智能辅助** - AI 自动计算最佳布局
- ✅ **用户友好** - 直观的交互界面

现在就开始使用，体验 AI 驱动的智能设计缩放！🚀

---

**文档版本**: 1.0.0  
**最后更新**: 2024-01  
**功能状态**: ✅ 已完成







