# 页面空白问题诊断指南

## 问题现象
访问 `http://localhost:3100/canvas/default` 后，页面完全空白，没有任何元素显示。

## 诊断步骤

### 1. 打开浏览器开发者工具

**按 F12** 或右键选择"检查"

### 2. 检查 Console 标签

查看是否有**红色错误信息**，常见错误包括：

#### 错误 A: "Cannot read properties of undefined"
```
可能原因：某个Provider或组件初始化失败
解决方案：查看完整错误堆栈，找到出错的组件
```

#### 错误 B: "Failed to fetch" 或 "Network request failed"
```
可能原因：API请求失败
解决方案：检查后端是否正常运行
```

#### 错误 C: Tailwind/CSS 相关错误
```
可能原因：样式文件加载失败
解决方案：检查 Network 标签，查看 CSS 文件是否加载成功
```

### 3. 检查 Elements 标签

在 Elements 标签中查看 DOM 结构：

#### 检查 #root 元素
```html
<!-- 正常情况 -->
<div id="root">
  <div class="app-container">
    <!-- 应该有内容 -->
  </div>
</div>

<!-- 异常情况 -->
<div id="root">
  <!-- 空的，没有任何子元素 -->
</div>
```

#### 检查元素样式
选中 `<div id="root">` 查看计算后的样式：
- `display`: 应该是 `block` 或其他非 `none` 值
- `opacity`: 应该是 `1`
- `visibility`: 应该是 `visible`

### 4. 检查 Network 标签

刷新页面后查看：

#### 关键文件是否加载成功
- `index.css` - 样式文件
- `main.tsx` - 主入口文件
- 各种 `.js` 文件 - React组件

#### 查看失败的请求
如果有**红色**的请求，点击查看详情：
- 404: 文件不存在
- 500: 服务器错误
- CORS: 跨域问题

### 5. 手动测试代码

在 Console 中执行：

```javascript
// 检查 React Root
const root = document.getElementById('root');
console.log('Root element:', root);
console.log('Root children:', root?.children);
console.log('Root innerHTML length:', root?.innerHTML?.length);

// 检查样式
const rootStyle = window.getComputedStyle(root);
console.log('Root display:', rootStyle.display);
console.log('Root opacity:', rootStyle.opacity);
console.log('Root visibility:', rootStyle.visibility);

// 检查 body
console.log('Body children:', document.body.children);

// 检查React挂载
console.log('React app mounted:', root?.children?.length > 0);
```

## 常见问题和解决方案

### 问题 1: #root 元素为空

**原因**：React应用没有成功挂载

**解决方案**：
1. 查看Console是否有JavaScript错误
2. 检查 `/src/main.tsx` 是否正确加载
3. 清除浏览器缓存：Ctrl+Shift+Delete

### 问题 2: 元素存在但不可见

**原因**：CSS样式问题

**解决方案**：
```javascript
// 在Console中执行，强制显示所有元素
document.querySelectorAll('*').forEach(el => {
  el.style.opacity = '1';
  el.style.visibility = 'visible';
  el.style.display = 'block';
});
```

### 问题 3: Tailwind CSS 未生效

**原因**：Tailwind未正确编译

**解决方案**：
```bash
# 重启前端服务
cd /home/ubuntu/jaaz
bash restart_frontend.sh
```

### 问题 4: Provider 阻塞渲染

**原因**：AuthProvider 或 ConfigsProvider 初始化卡住

**检查方法**：
1. 打开 Console
2. 查找日志 "Getting auth status"
3. 查找日志 "Development mode: skipping token refresh"

**如果卡住了**：
```javascript
// 清除localStorage可能解决问题
localStorage.clear();
location.reload();
```

## 快速修复方案

### 方案 1: 清除缓存重启

```bash
cd /home/ubuntu/jaaz/react
rm -rf node_modules/.vite
cd ..
bash restart_frontend.sh
```

然后在浏览器中：
1. 按 Ctrl+Shift+Delete
2. 清除缓存
3. 按 Ctrl+F5 硬刷新

### 方案 2: 清除 localStorage

在浏览器 Console 中执行：
```javascript
localStorage.clear();
sessionStorage.clear();
location.reload();
```

### 方案 3: 使用诊断页面

访问：
```
http://localhost:3100/test-canvas.html
```

点击"检查 DOM 结构"按钮，查看实际的DOM树。

## 详细调试流程

### 步骤 1: 确认服务运行
```bash
# 检查前端
curl http://127.0.0.1:3100/

# 检查后端
curl http://127.0.0.1:58000/api/config
```

### 步骤 2: 检查HTML是否正确
```bash
curl -s http://127.0.0.1:3100/ | grep -E "root|main.tsx"
```

应该看到：
```html
<div id="root"></div>
<script type="module" src="/src/main.tsx"></script>
```

### 步骤 3: 检查是否是Canvas特定的问题

访问首页测试：
```
http://localhost:3100/
```

如果首页也是空白 → React应用整体有问题
如果首页正常 → Canvas路由有问题

### 步骤 4: 查看前端日志

```bash
tail -50 /tmp/jaaz_frontend.log
```

查找错误信息。

## 如果以上都无效

请提供以下信息：

1. **浏览器Console的完整错误信息**（截图）
2. **Network标签的截图**（显示所有请求）
3. **Elements标签的#root元素内容**（截图）
4. **执行以下命令的输出**：

```bash
# 检查服务状态
ps aux | grep -E "vite|node.*jaaz" | grep -v grep

# 检查端口
netstat -tlnp | grep -E "3100|58000"

# 查看前端日志
tail -100 /tmp/jaaz_frontend.log
```

## 测试检查清单

- [ ] 浏览器控制台无红色错误
- [ ] Network 标签所有文件加载成功（200状态）
- [ ] #root 元素存在且有子元素
- [ ] main.tsx 和 index.css 加载成功
- [ ] localStorage.clear() 后刷新
- [ ] 硬刷新（Ctrl+Shift+R）
- [ ] 尝试其他浏览器（Chrome/Firefox/Edge）
- [ ] 前后端服务都正常运行





