# 🎯 Jaaz PSD分层缩放 - 快速参考

## 端口配置

| 服务 | 端口 | 地址 |
|------|------|------|
| 前端 | **3100** | http://localhost:3100 |
| 后端 | **58000** | http://localhost:58000 |

## 立即使用

### 1️⃣ 刷新浏览器
```
Ctrl + Shift + R (Windows/Linux)
Cmd + Shift + R (Mac)
```

### 2️⃣ 访问
```
http://localhost:3100/canvas/default
```

### 3️⃣ 操作
1. 上传PSD文件
2. 点击"智能缩放"（AI图标）
3. 选择"缩放单个PSD文件"
4. 启用"分层模式 ✨"
5. 设置目标尺寸
6. 开始缩放

## 服务管理

### 检查状态
```bash
cd /home/ubuntu/jaaz
./check_services.sh
```

### 重启前端
```bash
cd /home/ubuntu/jaaz
./restart_frontend.sh
```

### 重启后端
```bash
cd /home/ubuntu/jaaz
./restart_backend.sh
```

## 核心API

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/psd/resize/resize-by-id` | POST | PSD合成缩放 |
| `/api/psd/resize/resize-by-id-layered` | POST | PSD分层缩放 |
| `/api/psd/resize/layered/{id}/layer_{idx}` | GET | 获取单层PNG |
| `/api/canvas/resize` | POST | 画布合成缩放 |
| `/api/canvas/resize-layered` | POST | 画布分层缩放 |

## 故障排查

### UI看不到新选项
```bash
# 强制刷新浏览器
Ctrl + Shift + R

# 或重启前端
./restart_frontend.sh
```

### API连接失败
```bash
# 检查服务状态
./check_services.sh

# 测试后端
curl http://127.0.0.1:58000/api/config
```

### 查看日志
```bash
# 前端日志
tail -f /tmp/jaaz_frontend.log

# 后端日志
tail -f /home/ubuntu/jaaz/server/backend.log
```

## 文件位置

| 文件 | 路径 |
|------|------|
| 前端UI组件 | `react/src/components/canvas/PSDResizeDialog.tsx` |
| 工具菜单 | `react/src/components/canvas/menu/CanvasToolMenu.tsx` |
| 后端PSD路由 | `server/routers/psd_resize_router.py` |
| 后端画布路由 | `server/routers/canvas_resize_router.py` |
| Gemini服务 | `server/services/gemini_psd_resize_service.py` |

## 分层输出

### 存储路径
```
user_data/files/psd/psd_layered_{timestamp}/
├── metadata.json
├── layer_000_xxx.png
├── layer_001_xxx.png
└── ...
```

### metadata.json格式
```json
{
  "file_id": "psd_layered_xxxxx",
  "target_size": {"width": 800, "height": 600},
  "layers": [
    {
      "index": 0,
      "name": "图层名称",
      "left": 0, "top": 0,
      "width": 800, "height": 600,
      "opacity": 100,
      "image_url": "/api/psd/resize/layered/.../layer_000"
    }
  ]
}
```

## 模式对比

| 特性 | 合成模式 | 分层模式 |
|------|----------|----------|
| 输出 | 1张PNG | N个PNG + JSON |
| 画布元素 | 1个 | N个 |
| 可编辑性 | 整体移动 | 每层独立 |
| 文件大小 | 小 | 较大 |
| 适用场景 | 最终展示 | 继续编辑 |

---

**最后更新**: 2024年10月29日  
**版本**: v1.0  
**端口**: 前端3100, 后端58000




